jv2629\_hw6
================
Jaclyn Verity - jv2629
November 27, 2018

Introduction
============

This document is to practice using linear models and graphing them for the Data Science Course HW 6.

Problem 1
=========

**Load the data.**

``` r
require(RCurl)
hom_raw = read_csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv") 
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_integer(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_character(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

**Clean the data.**

``` r
hom_clean = hom_raw %>% 
  mutate(city_state = paste(city, state, sep = ', '),
         outcome = as.factor(ifelse(disposition == 'Closed by arrest', 1, 0))) %>% 
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL"))) %>% 
   mutate(victim_race = as.factor(ifelse(victim_race == "White", "white", "non-white" )),
         victim_age = as.numeric(victim_age),
         victim_sex = as.factor(victim_sex),
         victim_race = fct_relevel(victim_race, "white", "non-white"))
```

    ## Warning in eval(substitute(expr), envir, enclos): NAs introduced by
    ## coercion

**Run a GLM Model for Baltimore.**

``` r
hom_balt = hom_raw %>% 
  mutate(city_state = paste(city, state, sep = ', '),
         outcome = as.factor(ifelse(disposition == 'Closed by arrest', 'solved', 'unsolved'))) %>% 
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL"))) %>% 
  filter(city_state == "Baltimore, MD") %>% 
  mutate(victim_race = as.factor(ifelse(victim_race == "White", "white", "non-white" )),
         victim_age = as.numeric(victim_age),
         victim_sex = as.factor(victim_sex),
         victim_race = fct_relevel(victim_race, "white", "non-white"))

balt_outcomes = hom_balt %>% 
   glm(outcome ~ victim_age + victim_race + victim_sex, data = ., family = binomial()) %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate),
         low_OR = exp(estimate*1.96 - std.error),
         high_OR = exp(estimate*1.96 + std.error)) %>%
  select(OR, low_OR, high_OR, p.value) %>% 
  knitr::kable(digits = 3)
```

Creating a function for running glm and pulling it into a table.

``` r
hom_glm = hom_clean %>% 
  select(city_state, victim_race, victim_age, victim_sex, outcome)

glm_resolv_func = function(df){
  
 glm(df$outcome ~ df$victim_age + df$victim_race + df$victim_sex, data = df, family = binomial()) %>% 
    broom::tidy() %>% 
  mutate(OR = exp(estimate),
         low_OR = exp((estimate*1.96) - std.error),
         high_OR = exp((estimate*1.96) + std.error)) %>%
  select(term, OR, low_OR, high_OR)
}
```

Run function and create data frame.

``` r
hom_nest = nest(hom_glm, victim_race:outcome)

or_outcomes = hom_nest %>% 
  mutate(glm_out =
    map(hom_nest$data, glm_resolv_func)) %>% 
  select(-data) %>% 
  unnest() %>% 
  janitor::clean_names()
```

Plot of victim race for each city.

``` r
race_plot = or_outcomes %>% 
  filter(term == "df$victim_racenon-white")

race_plot %>% 
  mutate(city_state = fct_reorder(city_state, or)) %>% 
ggplot(aes(x = city_state, y = or)) +
  coord_flip() +
  geom_point() + 
  geom_errorbar(aes(ymin = low_or, ymax = high_or)) +
  theme(axis.text.x = element_text(angle = 80, hjust = 1)) +
  labs(x = "City", y = "Odds of Solved Murder based on Race (White v Non-White)")
```

<img src="jv2629_HW6_files/figure-markdown_github/unnamed-chunk-6-1.png" width="90%" />
